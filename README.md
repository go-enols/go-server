# Go åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [æ ¸å¿ƒç†å¿µ](#æ ¸å¿ƒç†å¿µ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [ç³»ç»Ÿäº¤äº’æµç¨‹](#ç³»ç»Ÿäº¤äº’æµç¨‹)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [TODO](#todo)

---
### Web UI
![Web UI ç•Œé¢](./image/show.png)


è¿™æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å®ç°çš„è½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œæ”¯æŒ WebSocket å®æ—¶é€šä¿¡ã€è´Ÿè½½å‡è¡¡ã€æ–¹æ³•æ–‡æ¡£åŒ–å’Œ Web UI è°ƒè¯•åŠŸèƒ½ã€‚æ—¨åœ¨é€šè¿‡å°†ä»»åŠ¡åˆ†å‘åˆ°å¤šä¸ª Worker èŠ‚ç‚¹å¹¶è¡Œå¤„ç†ï¼Œä»è€Œè§£å†³å•å°è®¡ç®—æœºåœ¨å¤„ç†è®¡ç®—å¯†é›†å‹æˆ– I/O å¯†é›†å‹ä»»åŠ¡æ—¶å¯èƒ½é‡åˆ°çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **å®æ—¶é€šä¿¡**ï¼šåŸºäº WebSocket çš„è°ƒåº¦å™¨ä¸ Worker é€šä¿¡
- âš–ï¸ **è´Ÿè½½å‡è¡¡**ï¼šæ™ºèƒ½ä»»åŠ¡åˆ†é…ï¼Œæ”¯æŒå¤š Worker è´Ÿè½½å‡è¡¡
- ğŸ“š **æ–¹æ³•æ–‡æ¡£åŒ–**ï¼šæ”¯æŒä¸ºæ³¨å†Œçš„æ–¹æ³•æ·»åŠ è¯¦ç»†æ–‡æ¡£è¯´æ˜
- ğŸ¯ **Web UI è°ƒè¯•**ï¼šå†…ç½® Web ç•Œé¢ï¼Œæ”¯æŒå®æ—¶ç›‘æ§å’Œæ–¹æ³•è°ƒè¯•
- ğŸ”„ **è‡ªåŠ¨é‡è¿**ï¼šWorker æ–­çº¿è‡ªåŠ¨é‡è¿æœºåˆ¶
- ğŸ’“ **å¿ƒè·³æ£€æµ‹**ï¼šå®æ—¶ç›‘æ§ Worker èŠ‚ç‚¹çŠ¶æ€
- ğŸ›¡ï¸ **å¹¶å‘å®‰å…¨**ï¼šè§£å†³ WebSocket å¹¶å‘å†™å…¥é—®é¢˜

## æ ¸å¿ƒç†å¿µ

æœ¬é¡¹ç›®çš„æ ¸å¿ƒç†å¿µæ˜¯å°†å¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°çš„ã€å¯ç‹¬ç«‹æ‰§è¡Œçš„å·¥ä½œå•å…ƒï¼Œå¹¶é€šè¿‡ä¸€ä¸ªä¸­å¿ƒåŒ–çš„è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰å°†è¿™äº›å·¥ä½œå•å…ƒåˆ†å‘ç»™ä¸€ç»„å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰ã€‚å®¢æˆ·ç«¯ï¼ˆClientï¼‰å¯ä»¥å‘è°ƒåº¦å™¨æäº¤ä»»åŠ¡è¯·æ±‚ï¼Œå¹¶è·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚

è¿™ç§æ¶æ„çš„ä¼˜åŠ¿åœ¨äºï¼š

*   **å¯ä¼¸ç¼©æ€§**ï¼šå¯ä»¥é€šè¿‡å¢åŠ  Worker èŠ‚ç‚¹çš„æ•°é‡æ¥æé«˜ç³»ç»Ÿçš„æ•´ä½“å¤„ç†èƒ½åŠ›
*   **çµæ´»æ€§**ï¼šä¸åŒçš„ Worker å¯ä»¥æ‰§è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œæ–¹ä¾¿æ¨ªå‘æ‰©å±•ç‰¹å®šåŠŸèƒ½
*   **å®¹é”™æ€§**ï¼šå•ä¸ª Worker èŠ‚ç‚¹çš„æ•…éšœä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œ
*   **å¯è§‚æµ‹æ€§**ï¼šé€šè¿‡ Web UI å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€å’Œè°ƒè¯•æ–¹æ³•

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ examples/         // ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ client/       // å®¢æˆ·ç«¯ç¤ºä¾‹
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ scheduler/    // è°ƒåº¦å™¨ç¤ºä¾‹
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ worker/       // Worker ç¤ºä¾‹
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ go-sdk/           // Go SDK
â”‚   â”œâ”€â”€ schedulersdk/ // å®¢æˆ·ç«¯ä¸è°ƒåº¦å™¨äº¤äº’çš„ SDK
â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â””â”€â”€ retry_client.go
â”‚   â””â”€â”€ workersdk/    // Worker ä¸è°ƒåº¦å™¨äº¤äº’çš„ SDK
â”‚       â”œâ”€â”€ call.go
â”‚       â””â”€â”€ worker.go
â”œâ”€â”€ python-sdk/       // Python SDK
â”‚   â”œâ”€â”€ schedulersdk/ // Python å®¢æˆ·ç«¯ SDK
â”‚   â”œâ”€â”€ workersdk/    // Python Worker SDK
â”‚   â””â”€â”€ examples/     // Python ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ node-sdk/         // Node.js SDK
â”‚   â”œâ”€â”€ schedulersdk/ // Node.js å®¢æˆ·ç«¯ SDK
â”‚   â”œâ”€â”€ workersdk/    // Node.js Worker SDK
â”‚   â””â”€â”€ examples/     // Node.js ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ image/            // é¡¹ç›®ç›¸å…³å›¾ç‰‡
â”œâ”€â”€ go.mod            // Go æ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum            // Go æ¨¡å—æ ¡éªŒå’Œæ–‡ä»¶
â”œâ”€â”€ index.html        // Web UI ç•Œé¢ï¼ˆåµŒå…¥åœ¨ scheduler.go ä¸­ï¼‰
â””â”€â”€ scheduler.go      // è°ƒåº¦å™¨æ ¸å¿ƒé€»è¾‘å®ç°ï¼ˆåŒ…å« Web UIï¼‰
```

## å¤šè¯­è¨€ SDK æ”¯æŒ

æœ¬é¡¹ç›®æä¾›å¤šç§ç¼–ç¨‹è¯­è¨€çš„ SDKï¼Œæ–¹ä¾¿ä¸åŒæŠ€æœ¯æ ˆçš„å¼€å‘è€…ä½¿ç”¨ï¼š

### ğŸ Python SDK

**å®‰è£…æ–¹å¼**:
```bash
# ä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰
pip install go-server-sdk

# æˆ–ä»æºç å®‰è£…
cd python-sdk
pip install -e .
```

**å¿«é€Ÿä½¿ç”¨**:
```python
# å®¢æˆ·ç«¯è°ƒç”¨
from schedulersdk import SchedulerClient

client = SchedulerClient("http://localhost:8080")
result = client.execute_sync("add", {"a": 1, "b": 2}, timeout=30.0)
print(f"Result: {result.result}")

# Worker æ³¨å†Œ
from workersdk import Worker, Config

def add_numbers(params):
    return params["a"] + params["b"]

config = Config(
    scheduler_url="http://localhost:8080",
    worker_group="python_workers"
)
worker = Worker(config)
worker.register_method("add", add_numbers, "Add two numbers")
worker.start()
```

### ğŸŸ¨ Node.js SDK

**å®‰è£…æ–¹å¼**:
```bash
npm install go-server-sdk
```

**å¿«é€Ÿä½¿ç”¨**:
```javascript
// å®¢æˆ·ç«¯è°ƒç”¨
const { SchedulerClient } = require('go-server-sdk');

const client = new SchedulerClient('http://localhost:8080');
const result = await client.executeSync('add', { a: 1, b: 2 });
console.log('Result:', result.result);

// Worker æ³¨å†Œ
const { Worker } = require('go-server-sdk');

const worker = new Worker({
    schedulerUrl: 'http://localhost:8080',
    workerGroup: 'node_workers'
});

worker.registerMethod('add', (params) => {
    return params.a + params.b;
}, 'Add two numbers');

worker.start();
```

### ğŸ”µ Go SDK

**ä½¿ç”¨æ–¹å¼**:
```bash
go get github.com/go-enols/go-server
```

**å¿«é€Ÿä½¿ç”¨**:
```go
// å®¢æˆ·ç«¯è°ƒç”¨
import "github.com/go-enols/go-server/workersdk"

result := workersdk.Call("http://localhost:8080", "add", map[string]any{
    "a": 1,
    "b": 2,
}, nil)

// Worker æ³¨å†Œ
import "github.com/go-enols/go-server/workersdk"

worker := workersdk.NewWorker("http://localhost:8080", "go_workers")
worker.RegisterMethod("add", addNumbers, "Add two numbers")
worker.Start()
```

## æ ¸å¿ƒç»„ä»¶

### 1. è°ƒåº¦å™¨ (Scheduler)
**æ–‡ä»¶**: `scheduler.go`, `schedulersdk/`

**ä¸»è¦åŠŸèƒ½**:
- ğŸŒ **Web UI ç®¡ç†ç•Œé¢**: æä¾›å®æ—¶ç›‘æ§å’Œè°ƒè¯•åŠŸèƒ½
- ğŸ“¡ **WebSocket é€šä¿¡**: ä¸ Worker èŠ‚ç‚¹å»ºç«‹æŒä¹…è¿æ¥
- âš–ï¸ **è´Ÿè½½å‡è¡¡**: æ ¹æ® Worker è´Ÿè½½æ™ºèƒ½åˆ†é…ä»»åŠ¡
- ğŸ’“ **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æµ‹ Worker èŠ‚ç‚¹çŠ¶æ€
- ğŸ“Š **ä»»åŠ¡ç®¡ç†**: è·Ÿè¸ªä»»åŠ¡çŠ¶æ€å¹¶è¿”å›ç»“æœ

**API ç«¯ç‚¹**:
- `GET /` - Web UI ç®¡ç†ç•Œé¢
- `GET /api/status` - è·å–ç³»ç»ŸçŠ¶æ€
- `POST /api/execute` - æ‰§è¡Œä»»åŠ¡
- `GET /api/result/{taskId}` - è·å–ä»»åŠ¡ç»“æœ
- `WS /api/worker/connect` - Worker è¿æ¥ç«¯ç‚¹

### 2. å·¥ä½œèŠ‚ç‚¹ (Worker)
**æ–‡ä»¶**: `workersdk/`, `examples/worker/`

**ä¸»è¦åŠŸèƒ½**:
- ğŸ”Œ **è‡ªåŠ¨è¿æ¥**: è‡ªåŠ¨è¿æ¥åˆ°è°ƒåº¦å™¨å¹¶æ³¨å†Œæ–¹æ³•
- ğŸ“š **æ–¹æ³•æ–‡æ¡£**: æ”¯æŒä¸ºæ³¨å†Œæ–¹æ³•æ·»åŠ è¯¦ç»†æ–‡æ¡£
- ğŸ”„ **è‡ªåŠ¨é‡è¿**: è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¿
- ğŸ’“ **å¿ƒè·³ä¿æŒ**: å®šæœŸå‘é€å¿ƒè·³ç»´æŒè¿æ¥
- ğŸ›¡ï¸ **å¹¶å‘å®‰å…¨**: è§£å†³ WebSocket å¹¶å‘å†™å…¥é—®é¢˜

**ç¤ºä¾‹æ–¹æ³•æ³¨å†Œ**:
```go
worker.RegisterMethod("add", addNumbers,
    "è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ",
    "å‚æ•°: {\"a\": number, \"b\": number}",
    "è¿”å›: number")
```

### 3. å®¢æˆ·ç«¯ (Client)
**æ–‡ä»¶**: `schedulersdk/`, `examples/client/`

**ä¸»è¦åŠŸèƒ½**:
- ğŸ“¤ **ä»»åŠ¡æäº¤**: å‘è°ƒåº¦å™¨æäº¤ä»»åŠ¡è¯·æ±‚
- ğŸ” **çŠ¶æ€æŸ¥è¯¢**: æŸ¥è¯¢ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- ğŸ“¥ **ç»“æœè·å–**: è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ
- ğŸ”„ **é‡è¯•æœºåˆ¶**: æ”¯æŒè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚

**ä½¿ç”¨ç¤ºä¾‹**:
```go
workersdk.Call("http://localhost:8080", "add", map[string]any{
    "a": 1,
    "b": 2,
}, nil)
```

## äº¤äº’æµç¨‹

1. **å¯åŠ¨è°ƒåº¦å™¨**: è°ƒåº¦å™¨å¯åŠ¨å¹¶ç›‘å¬ç«¯å£ 8080ï¼Œæä¾› Web UI å’Œ API æœåŠ¡
2. **Worker æ³¨å†Œ**: Worker èŠ‚ç‚¹é€šè¿‡ WebSocket è¿æ¥åˆ°è°ƒåº¦å™¨å¹¶æ³¨å†Œå¯ç”¨æ–¹æ³•
3. **ä»»åŠ¡æäº¤**: å®¢æˆ·ç«¯é€šè¿‡ API æˆ– Web UI æäº¤ä»»åŠ¡è¯·æ±‚
4. **è´Ÿè½½å‡è¡¡**: è°ƒåº¦å™¨æ ¹æ® Worker è´Ÿè½½é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡
5. **ä»»åŠ¡æ‰§è¡Œ**: Worker æ¥æ”¶ä»»åŠ¡å¹¶æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘
6. **ç»“æœè¿”å›**: Worker å°†æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒåº¦å™¨ï¼Œè°ƒåº¦å™¨å†è¿”å›ç»™å®¢æˆ·ç«¯
7. **å®æ—¶ç›‘æ§**: é€šè¿‡ Web UI å®æ—¶æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œè°ƒè¯•æ–¹æ³•

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- Go 1.19+ (è¯·æ ¹æ® `go.mod` æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å®‰è£…)

### 1. å¯åŠ¨è°ƒåº¦å™¨

```bash
# æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ
go run go-sdk/examples/scheduler/main.go

# æ–¹å¼äºŒï¼šæ„å»ºåè¿è¡Œ
go build -o scheduler ./go-sdk/examples/scheduler
./scheduler
```

è°ƒåº¦å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
Scheduler started on :8080
Web UI available at: http://localhost:8080
```

### 2. å¯åŠ¨ Worker

```bash
go run go-sdk/examples/worker/main.go
```

Worker å¯åŠ¨åä¼šè‡ªåŠ¨è¿æ¥åˆ°è°ƒåº¦å™¨å¹¶æ³¨å†Œæ–¹æ³•ã€‚

### 3. ä½¿ç”¨ Web UI

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8080`ï¼Œä½ å¯ä»¥ï¼š

- ğŸ“Š **å®æ—¶ç›‘æ§**: æŸ¥çœ‹ Worker çŠ¶æ€ã€æ–¹æ³•åˆ—è¡¨å’Œä»»åŠ¡ç»Ÿè®¡
- ğŸ”§ **æ–¹æ³•è°ƒè¯•**: é€‰æ‹©æ–¹æ³•ã€è¾“å…¥å‚æ•°ã€æ‰§è¡Œå¹¶æŸ¥çœ‹ç»“æœ
- ğŸ“š **æŸ¥çœ‹æ–‡æ¡£**: æŸ¥çœ‹æ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†æ–‡æ¡£è¯´æ˜

### 4. ä½¿ç”¨å®¢æˆ·ç«¯ API

```bash
go run go-sdk/examples/client/main.go
```

æˆ–è€…ç›´æ¥è°ƒç”¨ APIï¼š
```bash
curl -X POST http://localhost:8080/api/execute \
  -H "Content-Type: application/json" \
  -d '{"method":"add","params":{"a":1,"b":2}}'
```

## é«˜çº§åŠŸèƒ½

### Web UI è°ƒè¯•

Web UI æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼š

1. **æ–¹æ³•é€‰æ‹©**: ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©è¦è°ƒè¯•çš„æ–¹æ³•
2. **å‚æ•°è¾“å…¥**: ä»¥ JSON æ ¼å¼è¾“å…¥æ–¹æ³•å‚æ•°
3. **è¶…æ—¶è®¾ç½®**: è®¾ç½®ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶é—´
4. **å®æ—¶ç»“æœ**: æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œè¿”å›ç»“æœ
5. **é”™è¯¯å¤„ç†**: æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### è´Ÿè½½å‡è¡¡

è°ƒåº¦å™¨ä¼šè‡ªåŠ¨æ ¹æ®ä»¥ä¸‹ç­–ç•¥è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼š
- é€‰æ‹©å½“å‰ä»»åŠ¡æ•°æœ€å°‘çš„ Worker
- ç¡®ä¿ Worker æ”¯æŒè¯·æ±‚çš„æ–¹æ³•
- å®æ—¶æ›´æ–° Worker è´Ÿè½½çŠ¶æ€

### æ–¹æ³•æ–‡æ¡£åŒ–

åœ¨æ³¨å†Œæ–¹æ³•æ—¶å¯ä»¥æ·»åŠ è¯¦ç»†æ–‡æ¡£ï¼š
```go
worker.RegisterMethod("methodName", handler,
    "æ–¹æ³•æè¿°",
    "å‚æ•°è¯´æ˜",
    "è¿”å›å€¼è¯´æ˜")
```

## TODO

- [ ] æ”¯æŒè°ƒåº¦å™¨é›†ç¾¤æ¨¡å¼
- [ ] æ·»åŠ ä»»åŠ¡ä¼˜å…ˆçº§
- [ ] æ”¯æŒä»»åŠ¡é˜Ÿåˆ—æŒä¹…åŒ–
- [ ] æ·»åŠ æ›´å¤šç›‘æ§æŒ‡æ ‡
- [ ] æ”¯æŒæ–¹æ³•ç‰ˆæœ¬ç®¡ç†

## è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request æˆ– Issueã€‚